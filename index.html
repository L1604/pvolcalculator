<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prostate Volume Calculator (Custom Logic)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .calculator-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            width: 100%;
            max-width: 550px;
        }
        h1, h4 {
            text-align: center;
            color: #333;
        }
        h4 {
            font-weight: normal;
            margin-top:-15px;
            margin-bottom: 25px;
            color: #d9534f;
        }
        .model-selection {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .model-selection label {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .model-selection input[type="radio"] {
            display: none;
        }
        .model-selection input[type="radio"]:checked + label {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .input-section {
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .input-section h3 {
            margin-top: 0;
            font-size: 16px;
            color: #007bff;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        .input-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }
        button:hover {
            background-color: #218838;
        }
        #result {
            margin-top: 25px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 8px;
            text-align: left;
            font-size: 18px;
            line-height: 1.6;
            color: #333;
        }
        #result strong {
            font-size: 22px;
            color: #0056b3;
        }
        #result hr {
            border: 0;
            border-top: 1px solid #ccc;
            margin: 15px 0;
        }
        #result em {
            color: #555;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div class="calculator-container">
    <h1>Prostate Volume Calculator</h1>
    <h4></h4>

    <div class="model-selection">
        <input type="radio" id="model1" name="model" value="m1" checked>
        <label for="model1">TRUS-only</label>

        <input type="radio" id="model2" name="model" value="m2">
        <label for="model2">TRUS + MRI</label>

        <input type="radio" id="model3" name="model" value="m3">
        <label for="model3">TRUS + MRI + 3D</label>
    </div>

    <div id="inputs-container">
        <div id="m1_inputs">
            <div class="input-section">
                <h3>TRUS Inputs</h3>
                <div class="input-group">
                    <label>TRUS Antero-posterior Length (mm)</label>
                    <input type="number" id="m1_trus_h" placeholder="Antero-posterior Length">
                </div>
                <div class="input-group">
                    <label>TRUS Width (W) (mm)</label>
                    <input type="number" id="m1_trus_w" placeholder="Width">
                </div>
                <div class="input-group">
                    <label>TRUS Height (Cranio-caudal) (mm)</label>
                    <input type="number" id="m1_trus_l" placeholder="Cranio-caudal Height">
                </div>
            </div>
        </div>

        <div id="m2_inputs" class="hidden">
            <div class="input-section">
                <h3>TRUS Inputs</h3>
                <div class="input-group">
                    <label>TRUS Antero-posterior Length (mm)</label>
                    <input type="number" id="m2_trus_h" placeholder="Antero-posterior Length">
                </div>
                <div class="input-group">
                    <label>TRUS Width (W) (mm)</label>
                    <input type="number" id="m2_trus_w" placeholder="Width">
                </div>
                <div class="input-group">
                    <label>TRUS Height (Cranio-caudal) (mm)</label>
                    <input type="number" id="m2_trus_l" placeholder="Cranio-caudal Height">
                </div>
            </div>
            <div class="input-section">
                <h3>MRI Inputs</h3>
                <div class="input-group">
                    <label>MRI Antero-posterior Length (mm)</label>
                    <input type="number" id="m2_mri_h" placeholder="Antero-posterior Length">
                </div>
                <div class="input-group">
                    <label>MRI Width (W) (mm)</label>
                    <input type="number" id="m2_mri_w" placeholder="Width">
                </div>
                <div class="input-group">
                    <label>MRI Height (Cranio-caudal) (mm)</label>
                    <input type="number" id="m2_mri_l" placeholder="Cranio-caudal Height">
                </div>
            </div>
        </div>

        <div id="m3_inputs" class="hidden">
            <div class="input-section">
                <h3>TRUS Inputs</h3>
                <div class="input-group">
                    <label>TRUS Antero-posterior Length (mm)</label>
                    <input type="number" id="m3_trus_h" placeholder="Antero-posterior Length">
                </div>
                <div class="input-group">
                    <label>TRUS Width (W) (mm)</label>
                    <input type="number" id="m3_trus_w" placeholder="Width">
                </div>
                <div class="input-group">
                    <label>TRUS Height (Cranio-caudal) (mm)</label>
                    <input type="number" id="m3_trus_l" placeholder="Cranio-caudal Height">
                </div>
            </div>
            <div class="input-section">
                <h3>MRI Inputs</h3>
                <div class="input-group">
                    <label>MRI Antero-posterior Length (mm)</label>
                    <input type="number" id="m3_mri_h" placeholder="Antero-posterior Length">
                </div>
                <div class="input-group">
                    <label>MRI Width (W) (mm)</label>
                    <input type="number" id="m3_mri_w" placeholder="Width">
                </div>
                 <div class="input-group">
                    <label>MRI Height (Cranio-caudal) (mm)</label>
                    <input type="number" id="m3_mri_l" placeholder="Cranio-caudal Height">
                </div>
            </div>
            <div class="input-section">
                <h3>Other Inputs</h3>
                <div class="input-group">
                    <label>3D Slicer Volume (mL)</label>
                    <input type="number" id="m3_slicer_vol" placeholder="3D Volume">
                </div>
            </div>
        </div>
    </div>

    <button id="calculateBtn">CALCULATE</button>
    
    <div id="result">
        Predicted Volume Will Appear Here
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const models = document.querySelectorAll('input[name="model"]');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultDiv = document.getElementById('result');

        const inputGroups = {
            m1: document.getElementById('m1_inputs'),
            m2: document.getElementById('m2_inputs'),
            m3: document.getElementById('m3_inputs')
        };

        function updateVisibleInputs() {
            const selectedModel = document.querySelector('input[name="model"]:checked').value;
            for (const model in inputGroups) {
                inputGroups[model].classList.add('hidden');
            }
            inputGroups[selectedModel].classList.remove('hidden');
        }

        models.forEach(model => model.addEventListener('change', updateVisibleInputs));
        
        calculateBtn.addEventListener('click', function() {
            const selectedModel = document.querySelector('input[name="model"]:checked').value;
            let predictedVolume = 0;
            let comparisonEllipsoid = 0;
            let comparisonBullet = 0;
            const PI = Math.PI;

            try {
                if (selectedModel === 'm1') {
                    // h is Antero-posterior (AP), l is Cranio-caudal (CC), w is Width (W)
                    const h = parseFloat(document.getElementById('m1_trus_h').value); // AP
                    const w = parseFloat(document.getElementById('m1_trus_w').value); // W
                    const l = parseFloat(document.getElementById('m1_trus_l').value); // CC
                    
                    if ([h, w, l].some(isNaN)) throw new Error("Please fill in all fields.");
                    
                    // New TRUS-only formula
                    predictedVolume = -23.22 + (0.26 * h) + (0.29 * w) + (0.33 * l) + (0.0003 * (h * w * l));
                    
                    // Calculations for comparison purposes
                    comparisonEllipsoid = (PI / 6) * h * w * l / 1000;
                    comparisonBullet = (PI / 6) * w * h * h / 1000; // Bullet formula using W * AP^2

                } else if (selectedModel === 'm2') {
                    const trus_h = parseFloat(document.getElementById('m2_trus_h').value); // Antero-posterior
                    const trus_w = parseFloat(document.getElementById('m2_trus_w').value); // Width
                    const trus_l = parseFloat(document.getElementById('m2_trus_l').value); // Cranio-caudal
                    const mri_h = parseFloat(document.getElementById('m2_mri_h').value);   // MRI Antero-posterior
                    const mri_w = parseFloat(document.getElementById('m2_mri_w').value);   // MRI Width
                    const mri_l = parseFloat(document.getElementById('m2_mri_l').value);   // MRI Cranio-caudal
                    
                    if ([trus_h, trus_w, trus_l, mri_h, mri_w, mri_l].some(isNaN)) throw new Error("Please fill in all fields.");
                    
                    const trusEllipsoidVolume = (PI / 6) * trus_h * trus_w * trus_l / 1000;
                    predictedVolume = -20.71 + (0.27 * mri_h) + (0.20 * mri_w) + (0.29 * mri_l) + (0.69 * trusEllipsoidVolume);

                    comparisonEllipsoid = trusEllipsoidVolume;
                    comparisonBullet = (PI / 6) * trus_w * trus_h * trus_h / 1000; // Bullet formula using TRUS W * AP^2

                } else if (selectedModel === 'm3') {
                    const trus_h = parseFloat(document.getElementById('m3_trus_h').value); // Antero-posterior
                    const trus_w = parseFloat(document.getElementById('m3_trus_w').value); // Width
                    const trus_l = parseFloat(document.getElementById('m3_trus_l').value); // Cranio-caudal
                    const mri_h = parseFloat(document.getElementById('m3_mri_h').value);   // MRI Antero-posterior
                    const mri_w = parseFloat(document.getElementById('m3_mri_w').value);   // MRI Width
                    const mri_l = parseFloat(document.getElementById('m3_mri_l').value);   // MRI Cranio-caudal
                    const slicerVol = parseFloat(document.getElementById('m3_slicer_vol').value);

                    if ([trus_h, trus_w, trus_l, mri_h, mri_w, mri_l, slicerVol].some(isNaN)) throw new Error("Please fill in all fields.");

                    const trusEllipsoidVolume = (PI / 6) * trus_h * trus_w * trus_l / 1000;
                    predictedVolume = 5.12 - (0.01 * mri_h) - (0.09 * mri_w) - (0.04 * mri_l) + (0.37 * trusEllipsoidVolume) + (0.63 * slicerVol);

                    comparisonEllipsoid = trusEllipsoidVolume;
                    comparisonBullet = (PI / 6) * trus_w * trus_h * trus_h / 1000; // Bullet formula using TRUS W * AP^2
                }

                if (predictedVolume < 0) {
                    resultDiv.innerHTML = `Predicted Volume: <strong>Negative Value (${predictedVolume.toFixed(2)} mL)</strong>. Please check the inputs.`;
                } else {
                    resultDiv.innerHTML = `Predicted Volume: <strong>${predictedVolume.toFixed(2)} mL</strong><hr>` +
                                          `<em>For Comparison (using TRUS dimensions):</em><br>` +
                                          `Ellipsoid Formula: ${comparisonEllipsoid.toFixed(2)} mL<br>` +
                                          `Bullet Formula: ${comparisonBullet.toFixed(2)} mL`;
                }

            } catch (error) {
                alert(error.message);
                resultDiv.textContent = 'Calculation error!';
            }
        });

        // Initial check
        updateVisibleInputs();
    });
</script>

</body>
</html>
